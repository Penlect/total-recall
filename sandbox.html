<head>

</head>

<body>

<table border="1" >
<tr>
<td><input class="recall_input" id="recall_input_0" type="text" maxlength="1"></input></td>
<td><input class="recall_input" id="recall_input_1" type="text" maxlength="1"></input></td>
<td><input class="recall_input" id="recall_input_2" type="text" maxlength="1"></input></td>
</tr>
<tr>
<td><input class="recall_input" id="recall_input_3" type="text" maxlength="1"></input></td>
<td><input class="recall_input" id="recall_input_4" type="text" maxlength="1"></input></td>
<td><input class="recall_input" id="recall_input_5" type="text" maxlength="1"></input></td>
</tr>
</table>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<script>
$(document).ready(function(){

	class RecallGrid {
		constructor(rows, columns, cell){
			this.rows = rows;
			this.columns = columns;
			this.size = rows*columns;
			this.cell = cell;
		}
		
		select_next(){
		   var current_id = this.cell.attr('id');
		   console.log(current_id);
		   var size = this.size;
		   var new_id = current_id.replace( /(\d+)/, function(){return Math.min(arguments[1]*1+1, size) });
		   console.log(new_id);
		   $('#' + new_id).select();
		}
		
		select_previous(){
		   var current_id = this.cell.attr('id');
		   console.log(current_id);
		   var new_id = current_id.replace( /(\d+)/, function(){return Math.max(arguments[1]*1-1, 0) });
		   console.log(new_id);
		   $('#' + new_id).select();
		}
		
		select_up(){
		   var current_id = this.cell.attr('id');
		   console.log(current_id);
		   var self = this;
		   var new_id = current_id.replace( /(\d+)/, function(){return Math.max(arguments[1]*1-self.columns, 0) });
		   console.log(new_id);
		   $('#' + new_id).select();
		}
		
		select_down(){
		   var current_id = this.cell.attr('id');
		   console.log(current_id);
		   var self = this;
		   var size = this.size;
		   var new_id = current_id.replace( /(\d+)/, function(){return Math.min(arguments[1]*1 + self.columns, size) });
		   console.log(new_id);
		   $('#' + new_id).select();
		}
	}

   // User clicks on a cell
   $('.recall_input').keydown(function(e) {
	   e.preventDefault();
	   console.log("Key pressed = " + e.which)
	   
	   var grid = new RecallGrid(2, 3, $(this));
	   
		switch(e.which) {
			case 48: // 0
			case 49:
			case 50:
			case 51:
			case 52:
			case 53:
			case 54:
			case 55:
			case 56:
			case 57: // 9
				console.log("NUMERIC KEY");
				var digit = e.which - 48;
			   $(this).val(digit);
			   grid.select_next();
				break;
			case 39: // Right Arrow
			   grid.select_next();
				break;
			case 37: // Left Arrow
			   grid.select_previous();
				break;
			case 38: // Up Arrow
			    grid.select_up();
				break;
			case 40: // Down Arrow
				grid.select_down();
				break;
			case 80: // P character
			   var current_id = $(this).attr('id');
			   var new_value = '';
			   var prev_value = null;
			   for(i = parseInt(current_id.split('_')[2]); i < 6; i++){
					var cell_id = '#recall_input_' + i.toString();
					prev_value = $(cell_id).val();
					$(cell_id).val(new_value);
					new_value = prev_value;
			   }
				break;
			case 77: // m character
			   var current_id = $(this).attr('id');
			   var new_value = '';
			   var prev_value = null;
			   for(i = parseInt(current_id.split('_')[2]); i >= 0; i--){
					var cell_id = '#recall_input_' + i.toString();
					prev_value = $(cell_id).val();
					$(cell_id).val(new_value);
					new_value = prev_value;
			   }
				break;
			case 8: // backspace
				console.log("BACKSPACE KEY");
			   $(this).val('');
			   grid.select_previous();
			   break;
			case 46: // del key
				console.log("DELETE KEY");
			   $(this).val('');
			   grid.select_next();
			   break;
			default:
				console.log("INVALID KEY");
		}
   });
   
});
</script>
</body>